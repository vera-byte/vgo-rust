<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>v-connect-im QUIC Tester (WebTransport尝试)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif; margin: 20px; }
      h1 { font-size: 20px; }
      .row { margin: 8px 0; }
      input, button, textarea { font-size: 14px; padding: 6px; }
      textarea { width: 100%; height: 220px; }
      .label { display: inline-block; min-width: 120px; }
      .ok { color: #0a7; }
      .err { color: #c00; }
    </style>
  </head>
  <body>
    <!-- QUIC 测试尝试（WebTransport）/ QUIC testing attempt via WebTransport -->
    <h1>QUIC 测试（实验性）/ QUIC Test (Experimental)</h1>

    <p>
      说明 / Note：浏览器原生不支持任意 QUIC 连接，需 WebTransport 支持且服务器实现对应协议。当前服务基于
      <code>quiche</code> 的 QUIC，不保证可与浏览器 WebTransport 直接互通。此页面尝试 WebTransport 连接，如失败请使用
      <code>cargo run --example quic_client</code> 测试。
    </p>

    <div class="row"><span class="label">Origin(HTTPS):</span><input id="origin" value="https://127.0.0.1:5200" /></div>
    <div class="row"><button id="btnConnect">尝试连接 / Try Connect</button> <button id="btnClose">关闭 / Close</button></div>
    <div class="row"><span class="label">状态 / Status:</span><span id="status">未连接 / Disconnected</span></div>
    <div class="row"><span class="label">日志 / Logs:</span></div>
    <textarea id="logs" readonly></textarea>

    <script>
      const log = (msg, cls) => {
        const el = document.getElementById('logs');
        el.value += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
        el.scrollTop = el.scrollHeight;
        if (cls) document.getElementById('status').className = cls;
      };

      let wt = null;

      document.getElementById('btnConnect').onclick = async () => {
        const origin = document.getElementById('origin').value;
        if (!('WebTransport' in window)) { log('浏览器不支持WebTransport / WebTransport not supported', 'err'); return; }
        try {
          wt = new WebTransport(origin);
          await wt.ready;
          document.getElementById('status').textContent = '已连接(实验) / Connected (experimental)';
          document.getElementById('status').className = 'ok';
          log(`WebTransport ready to ${origin}`);
        } catch (e) {
          document.getElementById('status').textContent = '失败 / Failed';
          document.getElementById('status').className = 'err';
          log(`连接失败 / Connect failed: ${e}`);
        }
      };

      document.getElementById('btnClose').onclick = async () => {
        if (wt) {
          try { await wt.close(); } catch {}
          document.getElementById('status').textContent = '关闭 / Closed';
          document.getElementById('status').className = 'err';
          log('WebTransport closed');
        }
      };
    </script>
  </body>
  </html>

